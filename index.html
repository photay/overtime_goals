<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles.css">
  <script type="text/javascript" src="https://d3js.org/d3.v3.js" ></script>
  <script src="lib/d3-timeline.js"></script>
</head>

<body>
  <h1>This is a title!</h1>
  <!-- <p id="main-paragraph">Sports is always exciting.
    This years world cup
  </p> -->
  <object
    type="text/plain"
    data="paragraph.txt"
    style="overflow: hidden;">
  </object>
  <div class="transbox">
  </div>
  <script>

    var wc_file = "data/World_Cup_Stats_2018.csv";

    //Read Data from csv
    d3.csv(wc_file, function(d) {

      //Get all the goal times
      var goalTimes = [];
      for(item in d){
        if(item.startsWith("Goal") && d[item] != "" ){
           goalTimes.push(d[item]);
         }
      }

      //Return all the variables
      return {
        round: d.Round,
        game: d.Game,
        score: d.Score,
        winner: d.Winner,
        goal_times: goalTimes
      };
    }, function(data) {

      /* Circles for each goal*/
      var line_length = 1000;
      var default_color = "red";
      var default_radius = 5;
      d3.select("body").append("svg")
        .selectAll("g")
        .attr("class", "main_svg")
        .data(data)
        .enter()
        .append("g")
        .selectAll("circle")
        .data(d => d.goal_times, a => data)
        .enter()
        .append("circle")
        .attr("cx", function(el){

           if(el.includes("(")){
             el = el.split("(")[0];
           }
           if(el.includes(":")){
             el = el.split(":")[0];
           }
           var int_el = parseInt(el);

           var to_return =(int_el / 90) * line_length;

           if(isNaN(to_return)) return;
           else return to_return;

       })
       .attr("cy", function(d, a, i){
         console.log(i);
         return 30 * i;
       })
       .attr("r", default_radius)
       .style("fill", default_color)
       .on("mouseover", function(){
         d3.select(this).attr("r", 20).style("fill", "black");
       })
       .on("mouseout", function(){
          d3.select(this).attr("r", default_radius).style("fill", default_color);
       })
       ;

      /* Line for each game */
      d3.select("body")
        .select("svg")
        .selectAll("line")
        .attr("class", "main_svg")
        .data(data)
        .enter()
        .append("line")
        .attr("x1", 10)
        .attr("x2", line_length)
        .attr("y1", function(d, i){
          return 30 * i;
        })
        .attr("y2", function(d, i){
          return 30 * i;
        })
        ;

      /* Label for the lines */
      d3.select("body")
        .select("svg")
        // .selectAll("text")
        .data(data)
        .enter()
        .append("text")
        .attr("x", 0)
        .attr("y", function(d, i){
          return 30 * i;
        })
        .attr("text-anchor", "middle")
        .text(function(d){
          return data.game;
        })
        ;

    });
  </script>

</body>
</html>
